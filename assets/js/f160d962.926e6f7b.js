"use strict";(self.webpackChunkwovn_app_documentation=self.webpackChunkwovn_app_documentation||[]).push([[323],{9063:(n,t,e)=>{e.r(t),e.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"English/iOS/translate_push_notification","title":"Wovn Push Notification Feature","description":"This document assumes your app already can receive push notifications from Apple Push Notification service (APNs) or Firebase.","source":"@site/docs/English/iOS/translate_push_notification.md","sourceDirName":"English/iOS","slug":"/English/iOS/translate_push_notification","permalink":"/WovnAppDocumentation/docs/English/iOS/translate_push_notification","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"englishDocsSidebar","previous":{"title":"WOVN Settings Integration in the iOS Settings App","permalink":"/WovnAppDocumentation/docs/English/iOS/setup_wovn_settings_in_app_info"},"next":{"title":"Wovn SDK for iOS - Public API Reference (Swift)","permalink":"/WovnAppDocumentation/docs/English/iOS/wovn_apis"}}');var o=e(4848),a=e(8453);const s={},r="Wovn Push Notification Feature",c={},l=[{value:"Overview",id:"overview",level:2},{value:"Detail",id:"detail",level:2},{value:"1. How Wovn can translate your notification",id:"1-how-wovn-can-translate-your-notification",level:3},{value:"2. How to allow Wovn to access and then translate notification data from the server before showing it to the end user",id:"2-how-to-allow-wovn-to-access-and-then-translate-notification-data-from-the-server-before-showing-it-to-the-end-user",level:3},{value:"Testing the feature",id:"testing-the-feature",level:3},{value:"3. How to use Wovn to translate notification data containing sensitive user information",id:"3-how-to-use-wovn-to-translate-notification-data-containing-sensitive-user-information",level:2},{value:"4. How to use Wovn to translate local push notification",id:"4-how-to-use-wovn-to-translate-local-push-notification",level:2}];function d(n){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"wovn-push-notification-feature",children:"Wovn Push Notification Feature"})}),"\n",(0,o.jsx)(t.p,{children:"This document assumes your app already can receive push notifications from Apple Push Notification service (APNs) or Firebase."}),"\n",(0,o.jsx)(t.h2,{id:"overview",children:"Overview"}),"\n",(0,o.jsx)(t.p,{children:"In this document, you will learn:"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsx)(t.li,{children:"How Wovn can translate your notification"}),"\n",(0,o.jsx)(t.li,{children:"How to allow Wovn to access and then translate notification data from the server before showing it to the end user"}),"\n",(0,o.jsx)(t.li,{children:"How to use Wovn to translate notification data containing sensitive user information"}),"\n",(0,o.jsx)(t.li,{children:"How to use Wovn to translate local push notification"}),"\n"]}),"\n",(0,o.jsx)(t.h2,{id:"detail",children:"Detail"}),"\n",(0,o.jsx)(t.h3,{id:"1-how-wovn-can-translate-your-notification",children:"1. How Wovn can translate your notification"}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{alt:"Push Notification Overview",src:e(2283).A+"",width:"2986",height:"1658"})}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsx)(t.li,{children:"First, send a test push notification to your test device. This will allow Wovn to report the notification data to Wovn Dashboard and translate it."}),"\n",(0,o.jsx)(t.li,{children:"After Wovn Dashboard translated the notification data, send the same notification again to your test device to confirm."}),"\n",(0,o.jsx)(t.li,{children:"After confirming the notification has been translated, you can send it to all your users."}),"\n"]}),"\n",(0,o.jsx)(t.h3,{id:"2-how-to-allow-wovn-to-access-and-then-translate-notification-data-from-the-server-before-showing-it-to-the-end-user",children:"2. How to allow Wovn to access and then translate notification data from the server before showing it to the end user"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["In your server, make sure to add ",(0,o.jsx)(t.code,{children:'"mutable_content": true'})," to all push notifications. Without it, Apple will assume your notification will need no further editing and will display it without allowing any process to make any modification."]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["If you haven\u2019t extended UNNotificationServiceExten, to add custom logic, please do so by following this document by Apple: ",(0,o.jsx)(t.a,{href:"https://developer.apple.com/documentation/usernotifications/unnotificationserviceextension",children:"https://developer.apple.com/documentation/usernotifications/unnotificationserviceextension"})]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Since UNNotificationServiceExtension and your app run in separate sandboxes, we need to create a bridge to share data between them. We will use App Groups to do it:"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["Add ",(0,o.jsx)(t.code,{children:"group.io.wovn.workbox"})," to ",(0,o.jsx)(t.code,{children:"App Groups"})," of your main app. wovn-ios-demoapp in this example. ",(0,o.jsx)(t.img,{alt:"Push Notification App Group Main Target",src:e(3877).A+"",width:"871",height:"446"})]}),"\n",(0,o.jsxs)(t.li,{children:["Add ",(0,o.jsx)(t.code,{children:"group.io.wovn.workbox"})," to ",(0,o.jsx)(t.code,{children:"App Groups"})," of your Notification Service Extension. ",(0,o.jsx)(t.img,{alt:"Push Notification App Group Notification Service Extension",src:e(3102).A+"",width:"893",height:"441"})]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["Notify ",(0,o.jsx)(t.code,{children:"Wovn SDK"})," in both the main app and UNNotificationServiceExtension about the App Groups ",(0,o.jsx)(t.code,{children:"group.io.wovn.workbox"}),". Then translate push notifications."]}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["In AppDelegate.swift, change the ",(0,o.jsx)(t.code,{children:"Wovn.start"}),"'s code parameters of ",(0,o.jsx)(t.code,{children:"appGroupIdentifier"})," to ",(0,o.jsx)(t.code,{children:'"group.io.wovn.workbox"'}),", and ",(0,o.jsx)(t.code,{children:"isNotificationServiceEnv"})," to ",(0,o.jsx)(t.code,{children:"false"}),". Example: ",(0,o.jsx)(t.code,{children:'Wovn.start(appGroupIdentifier: "group.io.wovn.workbox", isNotificationServiceEnv: false)'})]}),"\n"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-swift",children:'func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -> Bool {\n    // Some application code\n    \n    // [BEFORE]\n    // Wovn.start(isDebugMode: _isDebugAssertConfiguration(), autoTranslateUIKit: true)\n\n    // [AFTER]\n    Wovn.start(\n        appGroupIdentifier: "group.io.wovn.workbox",\n        isDebugMode: _isDebugAssertConfiguration(),\n        autoTranslateUIKit: true,\n        isNotificationServiceEnv: false\n    )\n    // Some wovn code\n    // Some other application code\n}\n'})}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"Add the following code to NotificationService.swift in the UNNotificationServiceExtension folder."}),"\n"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-swift",children:'import UserNotifications\nimport WOVNswift\n\nclass NotificationService: UNNotificationServiceExtension {\n\n    var contentHandler: ((UNNotificationContent) -> Void)?\n    var bestAttemptContent: UNMutableNotificationContent?\n\n    override func didReceive(_ request: UNNotificationRequest, withContentHandler contentHandler: @escaping (UNNotificationContent) -> Void) {\n        Wovn.start(appGroupIdentifier: "group.io.wovn.workbox", isNotificationServiceEnv: true)\n        self.contentHandler = contentHandler\n        bestAttemptContent = (request.content.mutableCopy() as? UNMutableNotificationContent)\n        if let bestAttemptContent = bestAttemptContent {\n            let translatedContent = Wovn.translateNotificationContent(notiContent: bestAttemptContent)\n            contentHandler(translatedContent)\n        }\n    }\n    \n    override func serviceExtensionTimeWillExpire() {\n        // Called just before the extension will be terminated by the system.\n        // Use this as an opportunity to deliver your "best attempt" at modified content, otherwise the original push payload will be used.\n        if let contentHandler = contentHandler, let bestAttemptContent = bestAttemptContent {\n            contentHandler(bestAttemptContent)\n        }\n    }\n}\n\n'})}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"After step 4, your push notification content is translated, and stored in translatedContent. In the code above, we just go ahead and display it. But you can customize it further before showing it to the end user."}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(t.h3,{id:"testing-the-feature",children:"Testing the feature"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"We can send a push notification to the device via Firebase Cloud Messaging with the following data"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-json",children:'{\n    "to": "{YOUR TESTING DEVICE FCM TOKEN}",\n    "notification": {\n        "mutable_content": true, // Don\'t forget this line\n        "title": "\u3053\u3093\u306b\u3061\u306f",\n        "body": "\u7d20\u6674\u3089\u3057\u3044\u65e5\u3067\u3059\u306d\uff01"\n    }\n}\n'})}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"For the first time, your test device should receive a notification in Japanese. This is because Wovn does not have the translation for it yet. If you have allowed Wovn to report data, you should be able to find the title and body of the notification inside PushNotification screen in Wovn Dashboard"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.img,{alt:"push_notification_ios_before_translation",src:e(4753).A+"",width:"1125",height:"328"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.img,{alt:"push_notification_ios_dashboard_after_first_push_notification",src:e(185).A+"",width:"1380",height:"434"})}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["After translating the 2 values, then click ",(0,o.jsx)(t.code,{children:"Save and publish"}),", from the next time you send the same notification, it should be translated into the end-user language."]}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.img,{alt:"push_notification_ios_demo",src:e(6306).A+"",width:"884",height:"1920"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(t.h2,{id:"3-how-to-use-wovn-to-translate-notification-data-containing-sensitive-user-information",children:"3. How to use Wovn to translate notification data containing sensitive user information"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["Instead of adding user data directly into the ",(0,o.jsx)(t.code,{children:"title"})," or ",(0,o.jsx)(t.code,{children:"body"})," of the notification, you can use ",(0,o.jsx)(t.code,{children:"%{variable_name}%"})," instead, with its data inside data of the notification."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-json",children:'{   \n    "to": "{YOUR TESTING DEVICE FCM TOKEN}",\n    "notification": {\n        "mutable_content": true, // Don\'t forget this line\n        "title": "\u4eca\u6708\u306e\u8acb\u6c42\u66f8\u306e\u6e96\u5099\u304c\u3067\u304d\u307e\u3057\u305f, %name%\u3055\u3093!",\n        "body": "\u4eca\u6708\u306f%amount%\u5186\u3067\u3059\u3002 %date%\u307e\u3067\u306b\u304a\u652f\u6255\u3044\u304f\u3060\u3055\u3044"\n    },\n    "data": {\n        "name": "John Doe",\n        "amount": "10000",\n        "date": "2023/12/12"\n    }  \n}\n'})}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"Follow the same process when testing normal push notifications, your notifications with user-sensitive data can be translated too, without leaking any information."}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.img,{alt:"push_notification_ios_dashboard_after_dynamic_push_notification",src:e(8024).A+"",width:"1399",height:"579"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.img,{alt:"push_notification_ios_dynamic_pn_demo",src:e(1955).A+"",width:"884",height:"1920"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(t.h2,{id:"4-how-to-use-wovn-to-translate-local-push-notification",children:"4. How to use Wovn to translate local push notification"}),"\n",(0,o.jsxs)(t.p,{children:["You can use ",(0,o.jsx)(t.code,{children:"Wovn.translateNotificationData"})," to translate local push notification data before displaying it."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-swift",children:'var content = UNMutableNotificationContent()\ncontent.title = "\u3053\u3093\u306b\u3061\u306f%name%\u3055\u3093"\ncontent.subtitle = "\u304a\u91d1\u3092\u6255\u3063\u3066\u304f\u3060\u3055\u3044.%amount%\u30c9\u30eb\u3067\u3059"\ncontent.body = "\u671f\u9650\u5185\u306b\u304a\u652f\u6255\u3044\u3092\u304a\u9858\u3044\u3044\u305f\u3057\u307e\u3059\u3002%amount%\u30c9\u30eb\u3067\u3059"\ncontent.userInfo.updateValue("Jone Doe", forKey: "name")\ncontent.userInfo.updateValue("150", forKey: "amount")\ncontent.userInfo.updateValue("2099/12/12", forKey: "date")\ncontent.sound = UNNotificationSound.default\ncontent = Wovn.translateNotificationContent(notiContent: content)\n// Display local push notification code\n'})})]})}function h(n={}){const{wrapper:t}={...(0,a.R)(),...n.components};return t?(0,o.jsx)(t,{...n,children:(0,o.jsx)(d,{...n})}):d(n)}},3877:(n,t,e)=>{e.d(t,{A:()=>i});const i=e.p+"assets/images/push_notification_app_group_main_target-644b943a9d3d4e18a51f96d117798e2d.png"},3102:(n,t,e)=>{e.d(t,{A:()=>i});const i=e.p+"assets/images/push_notification_app_group_pn_target-1b732418b0cd7c9d9f5dd393de301d24.png"},4753:(n,t,e)=>{e.d(t,{A:()=>i});const i=e.p+"assets/images/push_notification_ios_before_translation-0943c951f49eaaef058813835045d646.png"},8024:(n,t,e)=>{e.d(t,{A:()=>i});const i=e.p+"assets/images/push_notification_ios_dashboard_after_dynamic_push_notification-1bb5cd371d43f4f83182bb37ff1d8959.png"},185:(n,t,e)=>{e.d(t,{A:()=>i});const i=e.p+"assets/images/push_notification_ios_dashboard_after_first_push_notification-ab45b960bb2906b112731ba043d7a4bb.png"},6306:(n,t,e)=>{e.d(t,{A:()=>i});const i=e.p+"assets/images/push_notification_ios_demo-455dc77c12bc9b8e429e1d6b570c1d11.gif"},1955:(n,t,e)=>{e.d(t,{A:()=>i});const i=e.p+"assets/images/push_notification_ios_dynamic_pn_demo-b03e02bc68979d2f03c6201f1b72fbc6.gif"},2283:(n,t,e)=>{e.d(t,{A:()=>i});const i=e.p+"assets/images/push_notification_overview-791b992efe5b9974e5806f4ad9f8509c.png"},8453:(n,t,e)=>{e.d(t,{R:()=>s,x:()=>r});var i=e(6540);const o={},a=i.createContext(o);function s(n){const t=i.useContext(a);return i.useMemo((function(){return"function"==typeof n?n(t):{...t,...n}}),[t,n])}function r(n){let t;return t=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:s(n.components),i.createElement(a.Provider,{value:t},n.children)}}}]);